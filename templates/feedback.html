<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Обратная связь — Bear's Anime</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='feedback.css') }}">
</head>
<body>
  <!-- NAV -->
  <header class="top-nav">
    <div class="nav-container">
      <div class="nav-logo">
        <a href="/anime">Bear's Anime</a>
      </div>
      <nav class="nav-links">
        <a href="/">Дом</a>
        <a href="/anime">Библиотека Аниме</a>
        <a href="/author">Об Авторе</a>
        <a href="/feedback">Обратная связь</a>
      </nav>
    </div>
  </header>

  <!-- FEEDBACK SECTION -->
  <main class="library">
    <h2>Обратная связь</h2>

    <section class="feedback-section fade-in">
      <p>Оставьте свой комментарий, указав Telegram username:</p>

      <form id="feedback-form" class="feedback-form">
        <label for="username">Telegram username:</label>
        <input type="text" id="username" name="username" placeholder="@username" required>

        <label for="message">Сообщение:</label>
        <textarea id="message" name="message" rows="6" placeholder="Ваш комментарий..." required></textarea>

        <button type="submit">Отправить</button>
      </form>

      <p id="feedback-response" class="feedback-response"></p>
    </section>
  </main>

  <!-- AJAX + fade-in -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const section = document.querySelector('.feedback-section');
      setTimeout(() => section.classList.add('visible'), 200);

      const form = document.getElementById('feedback-form');
      const responseText = document.getElementById('feedback-response');

      form.addEventListener('submit', async (e) => {
        e.preventDefault(); // предотвращаем стандартный submit

        const data = {
          username: form.username.value,
          message: form.message.value
        };

        try {
          const res = await fetch("/feedback", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });

          if(res.ok) {
            responseText.textContent = "Спасибо за ваш отзыв!";
            responseText.style.color = "#ff3b2f";
            responseText.classList.add('visible');
            form.reset();

            setTimeout(() => responseText.classList.remove('visible'), 5000);
          } else {
            responseText.textContent = "Ошибка при отправке, попробуйте позже.";
            responseText.style.color = "red";
            responseText.classList.add('visible');
          }
        } catch(err) {
          responseText.textContent = "Ошибка при отправке, попробуйте позже.";
          responseText.style.color = "red";
          responseText.classList.add('visible');
        }
      });
    });
  </script>
</body>
</html>
